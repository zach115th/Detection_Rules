title: GhostWebShell Command Invocation via SharePoint _layouts Directory
id: 93c94248-22a8-4d52-8042-bdc255e35434
status: experimental
description: |
  Detects HTTP requests to the in‑memory GhostWebShell that attackers register
  under “/_layouts/15|16/ghostfile<random>.aspx”.  The shell exposes a ?cmd=
  parameter; seeing both the unique path and the cmd query strongly suggests
  malicious interactive command execution.
author: Zachary Carter
date: 2025-07-28
references:
  - https://www.fortinet.com/blog/threat-research/inside-the-toolshell-campaign
tags:
  - attack.persistence
  - attack.defense-evasion
  - attack.t1505.003      # Web Shell
  - cve.2025-53770
  - detection.emerging-threats
logsource:
  product: iis
  category: webserver            # Works with IIS W3C logs

detection:
  selection_path:
    cs-uri-stem|contains: 
        - '/_layouts/1?/ghostfile.aspx'
        - '/_layouts/1?/ghostfile.?.aspx'
        - '/_layouts/1?/ghost.aspx'
        - '/_layouts/1?/ghost.?.aspx'
        - '/_layouts/1?/ghost?.aspx'
        - '/_layouts/1?/ghost?.?.aspx'
  selection_query:
    cs-uri-query|contains: '\?cmd=?'
  #  Method tends to be GET or POST; include if you log cs-method
  #  selection_method:
  #    cs-method:
  #      - 'GET'
  #      - 'POST'

  condition: selection_path and selection_query
falsepositives:
  - Unlikely.  “ghostfile*.aspx” does not exist in stock SharePoint, and combining it
    with a cmd parameter is highly suspicious.
level: high
